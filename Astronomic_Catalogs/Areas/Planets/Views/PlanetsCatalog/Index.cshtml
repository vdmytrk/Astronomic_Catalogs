@model IEnumerable<Astronomic_Catalogs.Models.NASAExoplanetCatalog>
@using Astronomic_Catalogs.Helpers
@using DocumentFormat.OpenXml.EMMA

@{
    ViewData["Title"] = "Planets";
    ViewBag.Contorller = "PlanetsCatalog";
    Layout = "~/Views/Shared/_Layout.cshtml";
    bool isAuthenticated = User.Identity?.IsAuthenticated ?? false;

    var planetType = new List<ExtendedSelectListItem>
    {
        new ExtendedSelectListItem { Value = "1", Text = "Dwarf\u2003\u2003\u2003\u2003\u2003\u2003\u2003\u2003\u2003\u2003\u2003\u2003\u2003", Value_1 = "0.04", Value_2 = "0.27" },
        new ExtendedSelectListItem { Value = "2", Text = "Mars-size\u2003\u2003\u2003\u2003\u2003\u2003\u2003\u2003\u2003", Value_1 = "0.27", Value_2 = "0.7" },
        new ExtendedSelectListItem { Value = "3", Text = "Earth-size\u2003\u2003\u2003\u2003\u2003\u2003\u2003\u2003", Value_1 = "0.7", Value_2 = "1.2" },
        new ExtendedSelectListItem { Value = "4", Text = "Super-Earth\u2003\u2003\u2003\u2003\u2003\u2003\u2003", Value_1 = "1.2", Value_2 = "1.9" },
        new ExtendedSelectListItem { Value = "5", Text = "Sub-Neptune\u2003\u2003\u2003\u2003\u2003\u2003\u2003", Value_1 = "1.9", Value_2 = "3.1" },
        new ExtendedSelectListItem { Value = "6", Text = "Neptune-size\u2003\u2003\u2003\u2003\u2003\u2003", Value_1 = "3.1", Value_2 = "5.1" },
        new ExtendedSelectListItem { Value = "7", Text = "Sub-Jupiter\u2003\u2003\u2003\u2003\u2003\u2003\u2003", Value_1 = "5.1", Value_2 = "8.3" },
        new ExtendedSelectListItem { Value = "8", Text = "Jupiter-size\u2003\u2003\u2003\u2003\u2003\u2003", Value_1 = "8.3", Value_2 = "13.7" },
        new ExtendedSelectListItem { Value = "9", Text = "Super(hot)-Jupiter", Value_1 = "13.7", Value_2 = "50" }
    };

    var orderBy = new List<SelectListItem>
    {
        new ExtendedSelectListItem { Value = "0", Text = "Unsorted data" },
        new ExtendedSelectListItem { Value = "1", Text = "By the distance of the closest-in planet" },
        new ExtendedSelectListItem { Value = "2", Text = "By the distance of the outermost planet" },
        new ExtendedSelectListItem { Value = "3", Text = "By the remoteness of the closest-in planet" },
        new ExtendedSelectListItem { Value = "4", Text = "By the remoteness of the outermost planet" },
        new ExtendedSelectListItem { Value = "5", Text = "By the size of the smallest planet" },
        new ExtendedSelectListItem { Value = "6", Text = "By the size of the largest planet" }
    };

    var planetsCount = Enumerable.Range(1, 8).Select(i => new SelectListItem { Value = i.ToString(), Text = i.ToString() }).ToList();

    var planetNames = ViewBag.PlanetNames as List<SelectListItem> ?? new();
    planetNames.Insert(0, new SelectListItem { Value = "0", Text = "All planets" });

    var telescopeNames = ViewBag.TelescopNames as List<SelectListItem> ?? new();
    telescopeNames.Insert(0, new SelectListItem { Value = "0", Text = "All telescopes" });

    var discoveryMethods = ViewBag.DiscoveryMethod as List<SelectListItem> ?? new();
    discoveryMethods.Insert(0, new SelectListItem { Value = "0", Text = "All methods" });
}

<div class="catalogPagesHeader p-3">
    <div class="row align-items-center">
        <div class="col">
            <h1 class="mb-3">Exoplanets of NASA catalog</h1>
        </div>
        <div class="col-auto ms-auto">
            <div class="d-flex flex-wrap align-items-center">
                @if (User.IsInRole("OwnerAdministratorPower"))
                {
                    <p class="mx-3 mt-2">
                        <a asp-action="Create">Create New</a>
                    </p>
                }
                @if (User.IsInRole("OwnerAdministratorPower"))
                {
                    <div class="col mx-3">
                        <button id="importPlanetDataButton" type="button" class="btn btn-primary">Import planet data</button>
                    </div>
                }
                <div class="mx-3">
                    <button type="button" class="btn btn-success btn-lg d-inline-block hideFilters">Hide filters</button>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-auto ms-auto">
                @if (User.IsInRole("OwnerAdministratorPower"))
                {
                    <div>
                        @if (TempData["Message"] != null)
                        {
                            <div class="alert alert-success">@TempData["Message"]</div>
                        }
                    </div>
                    <div class="row">
                        <div class="col-auto">
                            <button id="stopImportingPlanetDataButton" type="button" class="btn btn-primary">Stop importing planet data</button>
                        </div>
                    </div>
                    <div class="my-2 mx-2">
                        <div id="progressContainer" class="progress">
                            <div id="importProgress" class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar">0%</div>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>


    <div class="restrictedWrapper">
        <div class="allTopMenuFilters restrictedBlock">
            <div class="row mt-0">
                <div class="fieldsCheckBoks">
                    <h5 class="pHeader mt-2">Table columns:</h5>
                    <span class="">   Other catalogs columns: @Html.CheckBox("OtherCatalogsColumns", false, new { @class = "chb-OtherCatalogsColumns", onclick = "toggleCheckbox(this, 'OtherCatalogsColumns')" }) <span class="borderBlock pe-2">|</span></span>
                    <span class="">   System columns: @Html.CheckBox("SystemColumns", false, new { @class = "chb-SystemColumns", onclick = "toggleCheckbox(this, 'SystemColumns')" })                              <span class="borderBlock pe-2">|</span></span>
                    <span class="">   Discovery data columns: @Html.CheckBox("DiscoveryDataColumns", false, new { @class = "chb-DiscoveryDataColumns", onclick = "toggleCheckbox(this, 'DiscoveryDataColumns')" }) <span class="borderBlock pe-2">|</span></span>
                    <span class="">   Article columns: @Html.CheckBox("ArticleColumns", false, new { @class = "chb-ArticleColumns", onclick = "toggleCheckbox(this, 'ArticleColumns')" })                          <span class="borderBlock pe-2">|</span></span>
                    <span class="">   Planet columns: @Html.CheckBox("PlanetColumns", true, new { @class = "chb-PlanetColumns", onclick = "toggleCheckbox(this, 'PlanetColumns')" })                               <span class="borderBlock pe-2">|</span></span>
                    <span class="">   Star columns: @Html.CheckBox("StarColumns", false, new { @class = "chb-StarColumns", onclick = "toggleCheckbox(this, 'StarColumns')" })                                      <span class="borderBlock pe-2">|</span></span>
                    <span class="">   Coordinates columns: @Html.CheckBox("CoordinatesColumns", false, new { @class = "chb-CoordinatesColumns", onclick = "toggleCheckbox(this, 'CoordinatesColumns')" })          </span>
                </div>
                <div class="marginButton">
                    <button type="button" class="btn btn-primary setDefaultValueForAllFieldsCheckBox">
                        Restore beginning fields
                    </button>
                    <button type="button" class="btn btn-primary selectAllFieldsCheckBox">
                        Show all fields
                    </button>
                    <button type="button" class="btn btn-primary deselectAllFieldsCheckBox">
                        Hide all fields
                    </button>
                </div>
            </div>

            <!---------------------------------------------------------------------->
            <!-----------------------------    FORM    ----------------------------->
            <!---------------------------------------------------------------------->
            <div class="row topMenuFiltersCatalogs">
                <div class="m-0">
                    <h5 class="pHeader mt-4">Objects filters:</h5>
                    <div class="row m-0">
                        @********************************************************************************************************@
                        <div class="col-12 col-md-6 planetSizeBlock">
                            <div class="planetTypeBlock d-flex flex-column align-items-center text-center">
                                <span class="label fw-bold text-start">Planet syze:</span>
                                <div class="w-100 d-flex justify-content-center mb-3">
                                    <span class="label text-start">
                                        <span>Show only planets with a defined size:</span>
                                        <span>
                                            @Html.CheckBox("PlanetWithSize",
                                                     false,
                                                     new
                                                     {
                                                         @class = "chb-PlanetWithSize ms-3",
                                                         onclick = "toggleCheckbox(this, 'PlanetWithSize')"
                                                     })
                                        </span>
                                    </span>
                                </div>
                                <div class="w-100 d-flex justify-content-center">
                                    <span class="label fw-bold text-start">Planet type:</span>
                                </div>
                                <select id="planetTypeSelect" name="planetType"
                                        class="form-select mx-auto"
                                        multiple>
                                    @foreach (var item in planetType)
                                    {
                                        <option value="@item.Value">
                                            @item.Text — Size from @item.Value_1 to @item.Value_2 radius of Earth
                                        </option>
                                    }
                                </select>
                            </div>
                        </div>
                        @********************************************************************************************************@
                        <div class="col-12 col-md-auto fieldsBlock mt-3">
                            <div class="row">
                                <div class="col-12 col-md-6 col-lg-6 definedDataBlock mt-3">
                                    <div class="planetarySystemNameBlock mt-3">
                                        <div class="">
                                            <span class="label fw-bold">Planetary system name:</span>
                                            <div class="filter-fields">
                                                @Html.TextBox("Name", "", new { @class = "text-Name w-100" })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="discoveredPlenetCountBlock mt-3">
                                        <div class="label fw-bold">Discovered planets in planetary systems:</div>
                                        <div class="filter-fields row">
                                            <!-- FROM -->
                                            <div class="col-6">
                                                <div class="fw-semibold">from:</div>
                                                <div class="row g-1">
                                                    <div class="col dropDownListBlock">
                                                        <div class="flex-wrap">
                                                            @Html.DropDownList("discoveredPlenetCountFom", new SelectList(planetsCount, "Value", "Text", "1"), new { @class = "form-select", id = "discoveredPlenetCountFom", data_default = "1" })
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <!-- TO -->
                                            <div class="col-6">
                                                <div class="fw-semibold">to:</div>
                                                <div class="row g-1">
                                                    <div class="col dropDownListBlock">
                                                        <div class="flex-wrap">
                                                            @Html.DropDownList("discoveredPlenetCountTo", new SelectList(planetsCount, "Value", "Text", "8"), new { @class = "form-select", id = "discoveredPlenetCountTo", data_default = "8" })
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    @* Calendars *@
                                    <div class="discoveredDateBlock mt-3">
                                        <div class="row">
                                            <!-- FROM -->
                                            <div class="col-md-6">
                                                <label for="dateFrom" class="form-label fw-bold">Date From:</label>
                                                <input type="date" id="dateFrom" name="dateFrom"
                                                       class="form-control"
                                                       min="1992-01-01"
                                                       max="@DateTime.Now.ToString("yyyy-MM-dd")" />
                                            </div>
                                            <!-- TO -->
                                            <div class="col-md-6">
                                                <label for="dateTo" class="form-label fw-bold">Date To:</label>
                                                <input type="date" id="dateTo" name="dateTo"
                                                       class="form-control"
                                                       min="1992-01-01"
                                                       max="@DateTime.Now.ToString("yyyy-MM-dd")" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                @********************************************************************************************************@
                                <div class="col-12 col-md-auto col-lg-6 DropDownListBlock">
                                    <div class="mt-3">
                                        <span class="label fw-bold">Order by:</span>
                                        <div class="col dropDownListBlock">
                                            <div class="flex-wrap">
                                                @Html.DropDownList("OrderBy", new SelectList(orderBy, "Value", "Text", "0"), new { 
                                                    @class = "form-select", 
                                                    id = "exoplanetOrderby", 
                                                    data_default = "0" })
                                            </div>
                                        </div>
                                    </div>

                                    <div class="mt-3">
                                        <span class="label fw-bold">Planet name:</span>
                                        <div class="col dropDownListBlock">
                                            <div class="flex-wrap">
                                                @Html.DropDownList("PlanetName", planetNames, new { 
                                                    @class = "form-select", 
                                                    id = "exoplanetPlanetName", 
                                                    data_default = "0" })
                                            </div>
                                        </div>
                                    </div>


                                    <div class="mt-3">
                                        <span class="label fw-bold">Discovered with a telescope:</span>
                                        <div class="col dropDownListBlock">
                                            <div class="flex-wrap">
                                                @Html.DropDownList("Telescope", telescopeNames, new { 
                                                    @class = "form-select", 
                                                    id = "exoplanetTelescope", 
                                                    data_default = "0" })
                                            </div>
                                        </div>
                                    </div>


                                    <div class="mt-3">
                                        <span class="label fw-bold">Discovered with a method:</span>
                                        <div class="col dropDownListBlock">
                                            <div class="flex-wrap">
                                                @Html.DropDownList("DiscoveryMethod", discoveryMethods, new { 
                                                    @class = "form-select", 
                                                    id = "exoplanetDiscoveryMethod", 
                                                    data_default = "0" })
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        @********************************************************************************************************@
                    </div>
                </div>


                <div class="mt-0 additionalBlock">
                    <h5 class="pHeader mt-4">Additional:</h5>
                    <div class="row">
                        <div class="col-6">
                            <div class="d-flex flex-wrap align-items-center">
                                <h6 class="pe-2">Number of elements on the page:</h6>
                                @Html.DropDownList("RowOnPageCatalog", new SelectList(new string[] { "10", "20", "30", "50" }, "30"), new { @id = "RowOnPageCatalog", @required = "true", @data_default = "30" })
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="d-flex flex-wrap">
                                <div class="me-3">Fix the column width: </div>
                                <label class="switchButton switchButtonFixColumnWidth">
                                    <input type="checkbox" checked>
                                    <span class="slider"></span>
                                </label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="marginButton">
                    <button type="button" id="" class="btn btn-danger applyFiltersBtn m-2" data-controller="@ViewBag.Contorller">
                        APPLY FILTERS
                    </button>
                    <button type="button" class="btn btn-primary m-2" onclick="resetAllFilters()">
                        Reset all filters
                    </button>
                </div>
            </div>
            <!------------------------------------------------------------------------>
            <!-----------------------------   END FORM   ----------------------------->
            <!------------------------------------------------------------------------>

        </div>
    </div>



    <div id="paginationBodyBlockContainer">
        @await Html.PartialAsync("_PaginationLine")
    </div>

</div>


<div id="planetsTableContainer" class="hideShowColumnTable p-3">
    @await Html.PartialAsync("_PlanetsTableHeaders", Model)
</div>

<script>
    window.isAuthenticated = @(isAuthenticated.ToString().ToLower());
</script>

@section ScriptsPlanetViewCalendar {
    <script src="~/js/telescopeViewCalculator.min.js" asp-append-version="true"></script>
}